#include <Arduino.h>
#include <map>
#include <vector>
#include <functional>

#define SONG_COUNT 16

const int COIN_SONG[][2] PROGMEM = {{988, 100}, {1319, 300}};
const int UP_SONG[][2] PROGMEM = {{659, 125}, {784, 125}, {1319, 125}, {1047, 125}, {1175, 125}, {1568, 125}, {0, 250}};
const int FANFARE_SONG[][2] PROGMEM = {{0, 75}, {0, 25}, {262, 106}, {330, 93}, {392, 100}, {523, 100}, {659, 100}, {784, 300}, {659, 300}, {0, 75}, {0, 25}, {262, 106}, {311, 93}, {392, 100}, {523, 100}, {622, 100}, {831, 300}, {622, 300}, {0, 75}, {0, 25}, {294, 106}, {349, 93}, {466, 100}, {587, 100}, {698, 100}, {932, 300}, {932, 100}, {932, 100}, {932, 100}, {1047, 600}};
const int AXELF_SONG[][2] PROGMEM = {{349, 508}, {415, 381}, {349, 254}, {349, 127}, {466, 254}, {349, 254}, {311, 254}, {349, 508}, {523, 381}, {349, 254}, {349, 127}, {554, 254}, {523, 254}, {415, 254}, {349, 254}, {523, 254}, {698, 254}, {349, 127}, {311, 254}, {311, 127}, {262, 254}, {392, 254}, {349, 1270}, {0, 1016}};
const int HALL_SONG[][2] PROGMEM = {{247, 250}, {277, 250}, {294, 250}, {330, 250}, {370, 250}, {294, 250}, {370, 500}, {349, 250}, {277, 250}, {349, 500}, {330, 250}, {262, 250}, {330, 500}, {247, 250}, {277, 250}, {294, 250}, {330, 250}, {370, 250}, {294, 250}, {370, 250}, {494, 250}, {440, 250}, {370, 250}, {294, 250}, {370, 250}, {440, 1000}};
const int FUNERAL_SONG[][2] PROGMEM = {{466, 500}, {466, 375}, {466, 125}, {466, 500}, {554, 375}, {523, 125}, {523, 375}, {466, 125}, {466, 375}, {466, 125}, {466, 1000}};
const int ZOMBIE_SONG[][2] PROGMEM = {{123, 214}, {494, 214}, {587, 214}, {659, 214}, {740, 214}, {247, 214}, {123, 214}, {247, 214}, {123, 214}, {494, 214}, {587, 214}, {659, 214}, {740, 214}, {784, 214}, {740, 214}, {587, 214}, {659, 214}, {330, 214}, {165, 214}, {330, 214}, {587, 214}, {370, 214}, {740, 214}, {494, 214}, {123, 214}, {247, 214}, {123, 214}, {247, 214}, {123, 214}, {247, 214}, {123, 214}, {247, 214}, {123, 214}, {494, 214}, {587, 214}, {659, 214}, {740, 214}, {247, 214}, {123, 214}, {247, 214}, {123, 214}, {494, 214}, {587, 214}, {659, 214}, {740, 214}, {784, 214}, {740, 214}, {587, 214}, {659, 214}, {330, 214}, {165, 214}, {330, 214}, {587, 214}, {370, 214}, {740, 214}, {494, 214}, {123, 214}, {247, 214}, {123, 214}, {247, 214}, {123, 214}, {247, 214}, {123, 214}, {247, 214}};
const int INDIE_SONG[][2] PROGMEM = {{330, 346}, {349, 115}, {392, 230}, {523, 1038}, {0, 115}, {294, 346}, {330, 115}, {349, 1384}, {392, 346}, {440, 115}, {494, 230}, {698, 1038}, {0, 115}, {440, 346}, {494, 115}, {523, 461}, {587, 461}, {659, 461}, {330, 346}, {349, 115}, {392, 230}, {523, 1038}, {0, 115}, {587, 346}, {659, 115}, {698, 1384}, {392, 346}, {392, 115}, {659, 461}, {587, 346}, {392, 115}, {659, 461}, {587, 346}, {392, 115}, {659, 461}, {587, 346}, {392, 115}, {659, 230}, {587, 230}, {330, 346}, {349, 115}, {392, 230}, {523, 1038}, {0, 115}, {294, 346}, {330, 115}, {349, 1384}, {392, 346}, {440, 115}, {494, 230}, {698, 1038}, {0, 115}, {440, 346}, {494, 115}, {523, 461}, {587, 461}, {659, 461}};
const int KILLING_SONG[][2] PROGMEM = {{784, 250}, {784, 250}, {784, 250}, {784, 500}, {659, 250}, {494, 250}, {587, 500}, {523, 1250}, {0, 500}, {740, 250}, {740, 250}, {740, 250}, {740, 500}, {587, 250}, {440, 250}, {494, 1250}, {0, 1000}, {494, 250}, {494, 250}, {494, 250}, {494, 500}, {659, 250}, {784, 250}, {740, 500}, {659, 750}, {880, 250}, {880, 250}, {880, 250}, {784, 500}, {740, 1000}, {0, 250}, {587, 250}, {740, 500}, {659, 750}, {659, 250}, {659, 250}, {784, 250}, {659, 500}, {587, 1000}, {0, 250}, {392, 250}, {587, 500}, {523, 750}, {523, 250}, {523, 250}, {494, 500}, {0, 250}, {494, 500}, {440, 1125}, {0, 125}, {0, 1000}, {440, 250}, {440, 500}, {494, 2250}};
const int COFFIN_SONG[][2] PROGMEM = {{185, 483}, {185, 241}, {277, 241}, {247, 483}, {220, 483}, {208, 483}, {208, 241}, {220, 241}, {247, 483}, {220, 241}, {208, 241}, {185, 483}, {185, 241}, {440, 241}, {415, 241}, {440, 241}, {415, 241}, {440, 241}, {185, 483}, {185, 241}, {440, 241}, {415, 241}, {440, 241}, {415, 241}, {440, 241}, {185, 483}, {185, 241}, {277, 241}, {247, 483}, {220, 483}, {208, 483}, {208, 241}, {220, 241}, {247, 483}, {220, 241}, {208, 241}, {185, 483}, {185, 241}, {440, 241}, {415, 241}, {440, 241}, {415, 241}, {440, 241}, {185, 483}, {185, 241}, {440, 241}, {415, 241}, {440, 241}, {415, 241}, {440, 241}, {220, 241}, {220, 241}, {220, 241}, {220, 241}, {277, 241}, {277, 241}, {277, 241}, {277, 241}, {247, 241}, {247, 241}, {247, 241}, {247, 241}, {330, 241}, {330, 241}, {330, 241}, {330, 241}, {370, 241}, {370, 241}, {370, 241}, {370, 241}, {370, 241}, {370, 241}, {370, 241}, {370, 241}, {370, 241}, {370, 241}, {370, 241}, {370, 241}, {247, 241}, {220, 241}, {208, 241}, {165, 241}};
const int GBU_SONG[][2] PROGMEM = {{440, 125}, {587, 125}, {440, 125}, {587, 125}, {440, 1000}, {349, 500}, {392, 500}, {294, 1500}, {440, 125}, {587, 125}, {440, 125}, {587, 125}, {440, 1000}, {349, 500}, {392, 500}, {523, 1500}, {440, 125}, {587, 125}, {440, 125}, {587, 125}, {440, 1000}, {349, 500}, {330, 250}, {294, 250}, {262, 1500}, {440, 125}, {587, 125}, {440, 125}, {587, 125}, {440, 1000}, {392, 500}, {294, 3000}};
const int IMPERIAL_SONG[][2] PROGMEM = {{440, 500}, {440, 500}, {440, 500}, {349, 375}, {523, 125}, {440, 500}, {349, 375}, {523, 125}, {440, 1000}, {659, 500}, {659, 500}, {659, 500}, {698, 375}, {523, 125}, {415, 500}, {349, 375}, {523, 125}, {440, 500}, {0, 500}, {880, 500}, {440, 375}, {440, 125}, {880, 500}, {831, 375}, {784, 125}, {740, 125}, {698, 125}, {740, 250}, {0, 250}, {466, 250}, {622, 500}, {587, 375}, {554, 125}, {523, 125}, {494, 125}, {523, 250}, {0, 250}, {349, 250}, {415, 500}, {349, 333}, {0, 83}, {415, 83}, {523, 500}, {440, 375}, {523, 125}, {659, 1000}, {880, 500}, {440, 375}, {440, 125}, {880, 500}, {831, 375}, {784, 125}, {740, 125}, {698, 125}, {740, 250}, {0, 250}, {466, 250}, {622, 500}, {587, 375}, {554, 125}, {523, 125}, {494, 125}, {523, 250}, {0, 250}, {349, 250}, {415, 500}, {349, 291}, {0, 41}, {0, 83}, {523, 83}, {440, 500}, {349, 291}, {0, 41}, {0, 83}, {523, 83}, {440, 1000}};
const int GADGET_SONG[][2] PROGMEM = {{220, 187}, {247, 93}, {262, 186}, {294, 93}, {330, 280}, {262, 281}, {311, 281}, {247, 280}, {294, 280}, {262, 281}, {220, 187}, {247, 93}, {262, 186}, {294, 93}, {330, 280}, {440, 281}, {415, 1125}, {220, 187}, {247, 93}, {262, 186}, {294, 93}, {330, 280}, {262, 281}, {311, 281}, {247, 280}, {294, 280}, {262, 281}, {440, 187}, {415, 93}, {392, 186}, {370, 93}, {349, 749}, {330, 280}, {440, 562}, {220, 186}, {247, 93}, {262, 187}, {294, 93}, {330, 281}, {262, 281}, {311, 280}, {247, 280}, {294, 281}, {262, 281}, {220, 186}, {247, 93}, {262, 187}, {294, 93}, {330, 281}, {440, 281}, {415, 1123}, {220, 186}, {247, 93}, {262, 187}, {294, 93}, {330, 281}, {262, 281}, {311, 280}, {247, 280}, {294, 281}, {262, 281}, {440, 186}, {415, 93}, {392, 187}, {370, 93}, {349, 749}, {330, 281}, {440, 843}};
const int EVANGELION_SONG[][2] PROGMEM = {{262, 476}, {311, 476}, {349, 357}, {311, 357}, {349, 238}, {349, 238}, {349, 238}, {466, 238}, {415, 238}, {392, 119}, {349, 238}, {392, 595}, {392, 476}, {466, 476}, {523, 357}, {349, 357}, {311, 238}, {466, 238}, {466, 238}, {392, 238}, {466, 238}, {466, 357}, {523, 595}, {0, 476}, {622, 238}, {466, 119}, {466, 595}, {0, 238}, {622, 238}, {622, 357}, {698, 357}, {466, 238}, {466, 476}, {0, 238}, {466, 238}, {784, 357}, {831, 357}, {784, 238}, {698, 357}, {622, 357}, {698, 238}, {784, 357}, {831, 357}, {784, 238}, {523, 476}, {0, 238}, {523, 119}, {587, 119}, {622, 357}, {622, 357}, {587, 238}, {587, 476}, {0, 238}, {622, 119}, {698, 119}, {831, 357}, {784, 357}, {698, 238}, {622, 476}, {0, 238}, {784, 238}, {784, 357}, {698, 357}, {659, 238}, {698, 476}, {523, 476}, {523, 952}, {587, 952}};
const int JUMP_SONG[][2] PROGMEM = {{0, 454}, {587, 454}, {0, 227}, {659, 227}, {0, 454}, {523, 454}, {0, 227}, {523, 227}, {0, 227}, {587, 227}, {0, 227}, {587, 681}, {659, 454}, {0, 227}, {523, 227}, {0, 227}, {440, 454}, {392, 227}, {0, 227}, {392, 1136}};
const int MARIO_DAMAGE_SONG[][2] PROGMEM = {{440, 66}, {330, 66}, {220, 66}, {0, 200}, {440, 66}, {330, 66}, {220, 66}, {0, 200}, {440, 66}, {330, 66}, {220, 66}};

const int SONG_LENGTHS[SONG_COUNT] PROGMEM = {2, 7, 30, 24, 26, 11, 64, 57, 54, 82, 32, 76, 68, 68, 20, 11};
const char *const SONG_TITLES[SONG_COUNT] PROGMEM = {"Coin", "1-UP", "Mario_Fanfare", "AXELF", "Hall_of_the_Mountain_King", "Funeral_March", "Zombie_Nation", "Indiana_Jones", "Killing_Me_Softly", "Coffin_Dancers", "The_Good_the_Bad_and_the_Ugly", "Imerial_March", "Inspector_Gadget", "Neon_Genesis_Evangelion", "VanHalen-Jump", "Mario_Damage"};
const std::array<const int (*)[2], SONG_COUNT> SONGS = {COIN_SONG, UP_SONG, FANFARE_SONG, AXELF_SONG, HALL_SONG, FUNERAL_SONG, ZOMBIE_SONG, INDIE_SONG, KILLING_SONG, COFFIN_SONG, GBU_SONG, IMPERIAL_SONG, GADGET_SONG, EVANGELION_SONG, JUMP_SONG, MARIO_DAMAGE_SONG};

class Music
{
public:
    static const int BUZZER_PIN = D2;
    static const int COUNT = SONG_COUNT;
    static const char *const getTitle(const int i)
    {
        return SONG_TITLES[i];
    }
    static void play(const char title[])
    {
        for (int i = 0; i < COUNT; i++)
            if (strcmp(title, SONG_TITLES[i]) == 0)
            {
                play(i);
                return;
            }
    }
    static void play(const int song)
    {
        Serial.println(SONG_TITLES[song]);
        playSong(SONGS[song % COUNT], SONG_LENGTHS[song % COUNT]);
    }
    static void playRandom()
    {
        play(random(COUNT));
    }
    static void playCoin()
    {
        playSong(COIN_SONG, sizeof(COIN_SONG) / sizeof(COIN_SONG[0]));
    }

private:
    static void playSong(const int(song)[][2], int songLength)
    {
        for (int note = 0; note < songLength; note++)
        {
            const int noteDuration = song[note][1];
            tone(BUZZER_PIN, song[note][0], noteDuration);
            delay(noteDuration);
            noTone(BUZZER_PIN);
        }
    }
};
